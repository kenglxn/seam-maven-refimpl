<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<link rel="stylesheet" href="../styles/base/base.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../styles/page-layout/page-layout.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../styles/site/site.css" type="text/css" media="screen" />

<link href="../js/fullsize/fullsize.css" media="screen" rel="stylesheet" type="text/css" />

<script type="text/javascript" src="../js/jquery-min.js"></script>
<script type="text/javascript" src="../js/fullsize/jquery.fullsize.minified.js"></script>

<script type="text/javascript" src="../js/site.js"></script>

<script type="text/javascript">/* <![CDATA[ */
  $(document).ready(function() {
    $(".code-frame a").click(function( event ) {
      event.preventDefault(); 
      IframeHelper.toggle(this);
    });
    
    $('img').fullsize();
  });
/* ]]> */</script>

<title>Maven, Seam 2.2, Eclipse 3.6 and JBoss Tools 3.2 Work Log</title>
</head>

<body>
<div id="sizer">
<div id="expander">
<div id="page-wrapper">

<div id="header">
<div class="header">
  <h1>Maven, Seam 2.2, Eclipse 3.6 and JBoss Tools 3.2 Work Log</h1>
</div>
</div> 

<div id="page">

<ol>
	<li>
  	<a href="01-gettingstarted.html#checkout-install">Check Out, Install, Build and Run the Project</a>
  </li>
	<li>
  	<a href="01-gettingstarted.html#use-as-template">Use the seam-refimpl Project as a Template for Your Own Project</a>
  </li>
	<li>
  	<a href="01-gettingstarted.html#activate-development-mode">Activate Development Mode</a>
  </li>
  <li>
  	<a href="02-eclipse.html#configure-eclipse">Configure Eclipse and Create Workspace</a>
  </li>
  <li>
  	<a href="02-eclipse.html#configure-workspace">Install Plugins and Configure Workspace</a><br/>
    <strong>Note:</strong> You can not use Maven 3! The project externalizes some properties that is 
    used to generate the correct <code>jboss-app.xml</code> dependent on the targeted JBoss 
    Application Server. This works fine with Maven 2.2.1, but fails in Maven 3. The latest 
    Maven3.0-beta1 does not evaluate external properties during the 
    <code>ear:generate-application-xml</code> goal and you will get the following error message:<br/>
    <pre style="margin-top:.5em; margin-bottom:.5em; color:red">
    [ERROR] Failed to execute goal org.apache.maven.plugins:maven-ear-plugin:2.4.2:generate-application-xml 
    (default-generate-application-xml) on project mvn3-problem-ear: Failed to initialize JBoss configuration: 
    Invalid JBoss configuration, version[${as.version}] is not supported. -&gt; [Help 1]</pre>
    
    <img src="img/eclipse-maven-installations.png" longdesc="img/eclipse-maven-installations.png"
      class="screenshot" style="width:500px;" />

  	<strong>Maven3 Issue:</strong><br />
    Maven3 does not evaluate external properties during the "ear:generate-application-xml" goal. <br />
    In a portable build we want Maven to gernerate <code>application.xml</code> and <code>jboss.app.xml</code>
    based on property values stored in an external properties file. This works perfect i in Maven-2 but 
    not in Maven-3:
    
    <pre>
    
    &lt;plugin&gt;
      &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
      &lt;artifactId&gt;maven-ear-plugin&lt;/artifactId&gt;
      &lt;version&gt;2.4.2&lt;/version&gt;
      &lt;configuration&gt;
        &lt;finalName&gt;${app.context}-ear&lt;/finalName&gt;
        &lt;displayName&gt;${app.display.name}&lt;/displayName&gt;
        &lt;description&gt;${app.description}&lt;/description&gt;
        
        &lt;!-- 
          MNGECLIPSE-1541:
          During the import of a mavenized ear project (File &gt; Import... &gt; General &gt; Maven Projects) 
          an application.xml file is generated in src/main/application/META-INF/application.xml.
          https://issues.sonatype.org/browse/MNGECLIPSE-1541
          
          MNGECLIPSE-2145: 
          Generated application.xml doesn't contain final names
          https://issues.sonatype.org/browse/MNGECLIPSE-2145
          
          To fix this we excludes the eclipse generated application.xml during mvn package
        --&gt;
        &lt;earSourceExcludes&gt;**/application.xml&lt;/earSourceExcludes&gt;
        
        &lt;!-- Use maven generated application.xml --&gt;
        &lt;generateApplicationXml&gt;true&lt;/generateApplicationXml&gt;
        
        &lt;version&gt;5&lt;/version&gt;
        &lt;defaultLibBundleDir&gt;lib&lt;/defaultLibBundleDir&gt;
        &lt;encoding&gt;UTF-8&lt;/encoding&gt;
        
        &lt;jboss&gt;
          &lt;!--
            To trigger the generation of the jboss-app.xml file you need to
            configure the 'jboss' element. see:
            http://maven.apache.org/plugins/maven-ear-plugin/usage.html and:
            http://maven.apache.org/plugins/maven-ear-plugin/examples/generating-jboss-app.html
          --&gt;
          &lt;version&gt;${as.version}&lt;/version&gt;

          &lt;loader-repository&gt;
            &lt;!--
              seam.jboss.org is a Seam-specific scoped classloader. It acts as
              a way for Seam to disassociate artifacts bundled with the
              application from those that exist within the JBoss application
              server's shared artifacts or JARs (for example, those that
              reside in the default server's lib directory or in JBoss's
              general lib directory). 
              The classloader is referenced in jboss-app.xml for EAR deployment and and in 
              jboss-web.xml for WAR deployment (SiA-2.5.3-p63).
              see: http://www.jboss.org/community/wiki/classloadingconfiguration
              see: http://www.mastertheboss.com/en/jboss-application-server/141-jboss-classloader.html
            --&gt;
            seam.jboss.org:loader=${app.context}-ear
          &lt;/loader-repository&gt;

          &lt;data-sources&gt;
            &lt;data-source&gt;META-INF/ds/${ds.xml}&lt;/data-source&gt;
          &lt;/data-sources&gt;
        &lt;/jboss&gt;
        
        &lt;archive&gt;
          &lt;manifest&gt;
            &lt;addClasspath&gt;true&lt;/addClasspath&gt;
            &lt;addDefaultImplementationEntries&gt;true&lt;/addDefaultImplementationEntries&gt;
          &lt;/manifest&gt;
          &lt;manifestEntries&gt;
            &lt;Build-Machine&gt;${env.COMPUTERNAME}&lt;/Build-Machine&gt;
            &lt;Url&gt;${project.url}&lt;/Url&gt;
          &lt;/manifestEntries&gt;
        &lt;/archive&gt;

      &lt;/configuration&gt;
    &lt;/plugin&gt;   
    </pre>
    
    Properties are externalized to filter-*.properties file and read into maven using  
    <code><a href="http://mojo.codehaus.org/properties-maven-plugin/">org.codehaus.mojo:properties-maven-plugin</a></code>.
  </li>
  <li>
  	<a href="02-eclipse.html#import-project-into-eclipse">Import a Mavenized Seam Project into Eclipse</a><br/>
  </li>
  <li>
  	<strong>JBoss Tools 3.2 Issue:</strong><br />
   	<code>web.xml</code> is stripped for comments after project import, must restore original <code>web.xml</code> 
    from svn (not an issue in JBoss Tools 3.1).
  </li>
  <li>
  	<strong>m2eclipse issue:</strong><br />
    Incorrect JRE in EAR module after import.
  </li>
  <li>
  	<strong>m2eclipse issue:</strong><br />
    The EAR module's <code>src/application</code> folder should be source folder after import.
  </li>
  <li>
    EAR Deployment assembly<br />
  	<strong>JBoss Tools 3.2 Issue:</strong><br />
    Resource files should be published from the EAR target folder due to filtering of resource 
    files and generating of <code>application.xml</code> and  <code>jboss.app.xml</code> 
    during the Maven <code>generate-sources</code> goal.
  </li>
  <li>
    WAR Deployment assembly<br />
  	<strong>JBoss Tools 3.2 Issue:</strong><br />
    Resource files should be published from WAR target folder due to filtering of resource 
    files during the Maven <code>generate-sources</code> goal.
  </li>
  <li>
    EJB Deployment assembly<br />
    Do we need to make any modifications here? Looks like resource files are published from target?
  </li>
  <li>
  	Add EAR project to WTP server
  </li>
  <li>
  	Publish<br />
  	<strong>JBoss Tools 3.2 Issue:</strong><br />
    Seam jar is published to a separate folder.
  </li>
</ol>

</div> <!-- #page -->

</div> <!-- #page-wrapper -->

<div id="footer">  
<div class="footer">
  <ul class="links" style="text-align: center;">
    <li><a href="01-gettingstarted.html"><strong>Getting started</strong> tutorial</a></li>
    <li><a href="02-eclipse.html"><strong>Eclipse 3.5</strong> tutorial</a></li>
    <li><a href="03-intellij.html"><strong>IntelliJ</strong> tutorial</a></li>
    <li><a href="04-netbeans.html"><strong>NetBeans</strong> tutorial</a></li>
  </ul>
</div>
</div> <!-- #footer -->
</div> <!-- #expander -->
</div> <!-- #sizer -->

</body>
</html>
